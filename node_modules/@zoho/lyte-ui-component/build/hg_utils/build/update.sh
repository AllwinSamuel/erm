main()
{   
    basedir=`pwd`
    Arg=$1
    ROOT_HOME=${Arg}/WEB-INF/lib
    CLASS_HOME=$2
    OP_DIR=$3
    BaseZipPath="${5}"
    actualZipName="`basename ${BaseZipPath}`"
    prodzip_name="`echo ${actualZipName} | sed 's/\.[^.]*$//'`"
    mkdir -p ${OP_DIR}/../output
    
    cd ${CLASS_HOME}
    classes=`find -iname "*.class"`
    for i in `echo $classes | tr " " "\n"`
    do
        #echo $i
        classval=`echo $i | sed "s@\./@@g"`
        cd -
        cd ${ROOT_HOME}

        a=`grep -ir "$classval" .`
        b=`echo $a | sed "s@matches@@g" | sed "s@Binary file @@g"`
        jar_path=${ROOT_HOME}/$b
        cd -
        cd ${CLASS_HOME}
        jar -uf ${jar_path} $classval
        #q=`dirname ${jar_path}`
        mkdir -p ${OP_DIR}/WEB-INF/lib
        
        cp -rf ${jar_path} ${OP_DIR}/WEB-INF/lib
    
    done
    copy_prop $*
     
    cd ${out_dir}
    zip -r ROOT.war .

    mkdir -p AdventNet/Sas/tomcat/webapps/
    mv ROOT.war AdventNet/Sas/tomcat/webapps/

    zip -r ${prodzip_name}_patch.zip AdventNet

    cd ${Arg}
    cp -rfv ${out_dir}/** .
    rm -rf AdventNet ${prodzip_name}_patch.zip
    zip -ry ROOT.war .
    cp -fv ${BaseZipPath} .
    mkdir -p AdventNet/Sas/tomcat/webapps/
    cp -fv ${Arg}/ROOT.war AdventNet/Sas/tomcat/webapps/
    zip -ru ${Arg}/${prodzip_name}.zip AdventNet/Sas/tomcat/webapps/ROOT.war
    cp -fv ${Arg}/${prodzip_name}.zip ${OP_DIR}/
    cd ${3}/../../
}

copy_prop()
{
source_dir_path=$4
root_dir_path=$1
out_dir=$3
format="properties conf txt html sh xml"


for j in $format
do
        cd $source_dir_path
        prop_copy=`find -iname "*.$j" | grep -v "build"`

        for i in `echo $prop_copy`
        do
                filepath=`echo $i | sed "s@^\.\/@@g"`

                prop_filename=`basename $filepath`
                cd $root_dir_path
                root_file_path=`find -iname $prop_filename`

                root_dirname=`dirname $root_file_path | sed "s@^\.\/@@g"`
                if [ "$root_file_path" != "" ]
                then
                    for k in $root_dirname
                        do
                                mkdir -p ${out_dir}/$k
                                #cp -rf $root_dir_path/$root_dirname/$prop_filename ${out_dir}/$k
                                cp -rf $source_dir_path/$filepath ${out_dir}/$k
                        done


fi
        done
done

mkdir -p ${out_dir}/WEB-INF/blog/
cp -rf ${basedir}/version.txt ${out_dir}/WEB-INF/blog/
cp -rf ${basedir}/onezoho.txt ${out_dir}/WEB-INF/blog/

}


main $*
