<!DOCTYPE project [
<!ENTITY library SYSTEM "./library.xml">
]>

<project name="build" default="all" basedir=".">
    <taskdef resource="net/sf/antcontrib/antcontrib.properties"/>
    <property environment="env"/>
    <property file="ant.properties"/>

&library;

<!-- ============================================================================
       CALLING ALL TARGETS IN ORDER
     =========================================================================-->

<target name="all">
<mkdir dir="${basedir}/buildlogs"/>
<mkdir dir="${build_dir}"/>
<if>
     <isset property="target"/>
     <then>
        <propertycopy name="build_order" from="${target}_order" silent="true"/>
     </then>
     <else>
        <propertycopy name="build_order" from="local_order" silent="true"/>
     </else>
</if>


<antcall target="copy_js"/>

</target>



<target name="copy_js" >
    <if>
       <and>
           <not><available file="${basedir}/js_source.zip" type="file"/></not>
               <equals arg1="${sec_js_zip}" arg2="yes"/>
       </and>
           <then>

        <echo message="Source JS file copy added ${sec_js_zip}"/>
        <antcall target="copy">
              <param name="val" value="jscopy"/>
               <param name="jscopy_copy_todir" value="${basedir}/repo_js_dir/"/>
               <param name="jscopy_fileset_dir" value="${basedir}/../"/>
        <param name="jscopy_copy_includes" value="**/*.js  **/*.hbs  **/*.vue  **/*.jsx **/*.jsp **/*.hbs **/*.handlebars **/*package.json **/*.html"/>
        <param name="jscopy_copy_excludes" value="build/** node_modules/**"/>
         </antcall>


    <fileset id="repo_dir" dir="${basedir}/repo_js_dir/"/>

        <condition property="dir_empty">
           <length length="0"> <fileset refid="repo_dir"/> </length>
        </condition>

        <echo message="Js directory is empty" />

        <if>
                <isset property="dir_empty" />
              <then>
                             <echo message="Js directory empty" />

               </then>
                 <else>
                 <echo message="JS zip creation task call added." />
                     <antcall target="ziptask">
                         <param name="val" value="jszip"/>
                         <param name="jszip_zip_name" value="${basedir}/js_source.zip"/>
                           <param name="jszip_execdir" value="${basedir}/repo_js_dir/"/>
                           <param name="jszip_dir_tozip" value="."/>
                          <param name="jszip_zip_exclude" value=""/>
                      </antcall>

                </else>
        </if>

        </then>

        <else>
                <echo message="Source JS copy Not needed."/>
        </else>

</if>

</target>

</project>
