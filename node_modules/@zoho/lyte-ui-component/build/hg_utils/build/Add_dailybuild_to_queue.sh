main()
{
	[ $2 ] || { echo " Usage: <PRD_NAME> ; <text file>"; exit 1;}
	setvariable $*
}
setvariable()
{
	PRODUCT_NAME=$1
	TEXT_FILE=$2
	DATE_AND_TIME=`date +%Y%m%d%H%I%S`
	RANDOM_NUM=`echo $RANDOM`
	SERVER_NAME="integ-tools"
	LOGIN="nobody"

	MTXT_FILE=${PRODUCT_NAME}_${RANDOM_NUM}.txt
	LABEL=`grep -r "ARG" ${TEXT_FILE} | cut -d "=" -f2 | sed "s/\"//g"`
	BUILD_TYPE=`grep -r "BUILD_TYPE" ${TEXT_FILE} | cut -d "=" -f2 | sed "s/\"//g"`

	product_table=`curl -H "PRIVATE-TOKEN:FesQsaMc5H283a2n-i1x" http://cmtools.csez.zohocorpin.com/api/v1/products?name=$PRODUCT_NAME`
	pid=`echo $product_table | python -m json.tool | sed -n -e '/"id":/ s/[^0-9]*\(.*\),.*/\1/p'`
	queue=`curl -H "PRIVATE-TOKEN:FesQsaMc5H283a2n-i1x" http://cmtools.csez.zohocorpin.com/api/v1/webhost/queue_details?product_name=$PRODUCT_NAME`
	add_to_queue
}
add_to_queue()
{
	QCNT=`echo $queue | python -m json.tool | sed -n -e '/"id":/ s/[^0-9]*\(.*\),.*/\1/p' | wc -l`
	if [ ${QCNT} != 0 ]
	then
		QCNT=`expr ${QCNT} + 1`
	else
		QCNT=1
	fi
	cp -rvf ${TEXT_FILE} ${HOME}/${MTXT_FILE}
	rcp ${MTXT_FILE} ${LOGIN}@${SERVER_NAME}:/home/nobody/Tools/webhost/TXT
	rm -f ${HOME}/${MTXT_FILE}

	INSERT_QRY=`curl -H "PRIVATE-TOKEN:FesQsaMc5H283a2n-i1x" --data "id=''&product_id=$pid&release_version=NULL&duration=NULL&checkout_label=${LABEL}&build_label=NA&env=NULL&status=QUEUE&comment=DailyBuild&dependencies=NULL&url=NULL&started_by_id=18&build_type=${BUILD_TYPE}&started_from=Cron&availability=A&report_needed=true&deleted_date=NULL&deleted_by_id=NULL&size=NULL&static_version=NULL&customer_id=NULL&label_type=NULL&customize_info=NULL&created_at=''&updated_at=''" http://cmtools.csez.zohocorpin.com/api/v1/buildlogs`
	GET_DBID_QRY=`curl -H "PRIVATE-TOKEN:FesQsaMc5H283a2n-i1x" http://cmtools.csez.zohocorpin.com/api/v1/buildlogs?product_id=$pid&per_page=1`

	GET_DBID=`echo $GET_DBID_QRY | python -m json.tool | sed -n -e '/"id":/ s/[^0-9]*\(.*\),.*/\1/p'`
	
	WH_QBLD_ISRT=`curl -H "PRIVATE-TOKEN:FesQsaMc5H283a2n-i1x" --data "id=''&buildlog_id=$GET_DBID&product_name=$PRODUCT_NAME&started_by=integration-team&label=${LABEL}&queue_build_id=${QCNT}&queue_conf_id=${RANDOM_NUM}&record_queue_id=${QCNT}&created_at=''&updated_at=''" http://cmtools.csez.zohocorpin.com/api/v1/webhost/queue_details`

}
main $* > ${HOME}/dailybuild_queue_$1.log 2>&1
