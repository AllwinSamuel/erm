#! /usr/bin/python

from clonehook import *
import sys

classObject = updateTime("GET");

if len(sys.argv) > 2:
    ID = classObject.getProductId(sys.argv[1]);
    if not len(sys.argv) > 3:
        DBID = classObject.getDBID(sys.argv[1], sys.argv[2]);
        Changeset = classObject.getChangeset(DBID);
        if Changeset:
            print Changeset
        else:
            print None
    else:
        previousBuildDetails = classObject.getIDCbuildChangeset(sys.argv[2]);
        if previousBuildDetails:
            prev_build_id = previousBuildDetails['id']
            prev_build_label = previousBuildDetails['build_label']
            prev_build_url = previousBuildDetails['url']
            if prev_build_id:
                print "PREV_BUILD_ID=\""+ str(prev_build_id) + "\""
                print "PREV_DBUILD_LBL=\""+ str(prev_build_label) + "\""
                print "PREV_DBUILD_URL=\""+ str(prev_build_url) + "\""
                cs_details = classObject.getBuildChangeset(prev_build_id, product_id=ID)
                if cs_details:
                    if cs_details[0]['changeset']:
                        prev_src_changeset = cs_details[0]['changeset']
                        print "PREV_SRC_CHANGESET=\""+ str(prev_src_changeset) + "\""
                        if cs_details[0]['tp_changeset']:
                            prev_tp_changeset = cs_details[0]['tp_changeset']
                            print "PREV_TP_CHANGESET=\""+ str(prev_tp_changeset) + "\""
        else:
            logging.warning("Can't get previous build details")
else:
    print "python getIDCDetails.py <PRODUCT_NAME> <IDC URL>"
    sys.exit(1)
